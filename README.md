# Shopping Copilot (Шопинг-ассистент)

Интеллектуальный ассистент для онлайн-шопинга, который помогает пользователям искать товары, получать экспертные рекомендации и анализировать свои финансовые возможности.

демо сайт - http://62.113.44.21:3000


## Запуск

```
 >>> cd .\web-interface\ ; npm run dev
 >>> python -c "import uvicorn; uvicorn.run('api:app', reload=True)"
```

## Обзор решения

Shopping Copilot - это комплексное решение, разработанное для упрощения процесса онлайн-шопинга путем:

1. Определения потребностей пользователя через интерактивный диалог
2. Составления оптимального набора товаров с учетом бюджета пользователя
3. Предоставления возможности корректировки предложенного набора на основе обратной связи

### Ключевые возможности

- **Мультиролевой ассистент**: поддерживает несколько экспертных ролей (стилист, косметолог, нутрициолог, дизайнер)
- **Интеграция с маркетплейсами**: поиск товаров через API Wildberries
- **Анализ банковских выписок**: обработка и категоризация транзакций для финансового планирования
- **Интеграция с Pinterest**: поиск стилевых решений и референсов
- **Анализ изображений**: распознавание предметов одежды и других объектов
- **Персонализация**: запоминание предпочтений пользователя и адаптация рекомендаций

## Архитектура решения

### Бэкенд

Бэкенд построен на FastAPI и включает следующие основные компоненты:

1. **ChatAssistant** - центральный класс, предоставляющий функциональность для всех ролей и взаимодействия с моделями
2. **WildberriesAsyncAPI** - асинхронный клиент для интеграции с API Wildberries
3. **PinterestAPI** - клиент для взаимодействия с Pinterest
4. **BankStatementParser** - модуль для парсинга и анализа банковских выписок
5. **VisualAnalyzer** - компонент для анализа изображений

#### Ключевые модули

- **assistant.py** - реализация мультиролевого ассистента с поддержкой экспертных ролей
- **wildberries_async.py** - асинхронный клиент для API Wildberries
- **pinterest.py** - интеграция с Pinterest для поиска изображений
- **bank_statement_parser.py** - модуль для анализа банковских выписок
- **api.py** - API-эндпоинты для взаимодействия с фронтендом

### Фронтенд

Фронтенд разработан на Next.js (React) с использованием Tailwind CSS и включает:

1. **Компоненты ролевых ассистентов**:

   - StylistAssistant - помощь в подборе гардероба
   - CosmetologistAssistant - рекомендации по уходу за кожей
   - NutritionistAssistant - подбор питания
   - DesignerAssistant - оформление интерьера
2. **Модули анализа финансов**:

   - SpendingAnalysis - анализ расходов
   - TransactionsTable - таблица транзакций
   - RecommendedBudget - рекомендации по бюджету
3. **Интерактивные компоненты**:

   - ImageUploader - загрузка изображений
   - FileUpload - загрузка файлов (включая банковские выписки)
   - ProductCard - карточки товаров

## Особенности решения

### 1. Мультиролевой ассистент

Ассистент поддерживает несколько экспертных ролей, каждая из которых имеет специализированные промпты и алгоритмы:

- **Стилист**: помогает подобрать гардероб, найти сочетания одежды, дает рекомендации по стилю
- **Косметолог**: анализирует тип кожи и подбирает подходящие средства ухода
- **Нутрициолог**: создает планы питания, подбирает продукты, рассчитывает КБЖУ
- **Дизайнер**: предлагает решения для оформления интерьера, подбирает мебель и декор

### 2. Анализ банковских выписок

Система анализирует банковские выписки (в настоящее время поддерживаются выписки Тинькофф) для:

- Категоризации транзакций по типам расходов
- Анализа расходов по категориям и времени
- Расчета доступного бюджета для покупок
- Предоставления финансовых рекомендаций

### 3. Поиск товаров

Интеграция с маркетплейсами (Wildberries) позволяет:

- Искать товары по текстовому запросу
- Фильтровать товары по цене, категории и другим параметрам
- Получать актуальные цены и описания товаров
- Формировать оптимальную корзину товаров в рамках бюджета

### 4. Визуальный поиск и анализ

Система поддерживает работу с изображениями:

- Поиск стилевых референсов через Pinterest
- Анализ загруженных пользователем фотографий
- Распознавание предметов одежды и элементов интерьера
- Поиск похожих товаров по изображению

### 5. Персонализация и запоминание предпочтений

- Сохранение предпочтений пользователя (UserPreferences)
- Адаптация рекомендаций на основе истории взаимодействия
- Учет индивидуальных ограничений (диетические предпочтения, аллергии, стилевые предпочтения)

## Технологический стек

### Бэкенд

- **Python 3.9+**
- **FastAPI** - основной веб-фреймворк
- **OpenAI API** / **OpenRouter** - для работы с LLM
- **aiohttp** - для асинхронных HTTP-запросов
- **pdfplumber** - для обработки PDF-файлов банковских выписок
- **pandas** - для анализа данных
- **matplotlib** / **seaborn** - для визуализации данных

### Фронтенд

- **Next.js 14** - React-фреймворк
- **TypeScript** - типизированный JavaScript
- **Tailwind CSS** - утилитарный CSS-фреймворк
- **shadcn/ui** - компоненты пользовательского интерфейса
- **Tanstack Table** - для работы с таблицами
- **Recharts** - для визуализации данных

### Инфраструктура

- **Docker** / **Docker Compose** - для контейнеризации
- **Кэширование** - файловая система для кэширования ответов API
- **Метрики и логирование** - собственная система сбора и анализа метрик

## Примеры использования

### Стилист

```
Пользователь: Мне нужно подобрать летний гардероб для отпуска на море.
Бюджет 30 тысяч рублей, предпочитаю яркие цвета.

Ассистент: [Анализирует предпочтения, определяет необходимые элементы гардероба]

Ассистент: На основе ваших предпочтений, я подобрал следующий капсульный гардероб для отпуска:

1. Пляжная одежда:
   - Два купальника (яркий синий и коралловый) - 5000 ₽
   - Легкое парео - 1200 ₽

2. Повседневная одежда:
   - Три футболки (белая, голубая, яркая принтованная) - 3600 ₽
   - Две пары шорт (джинсовые и льняные) - 4000 ₽
   - Легкое платье - 3500 ₽
   - Льняные брюки - 2800 ₽

3. Обувь:
   - Сандалии - 2500 ₽
   - Шлепанцы для пляжа - 1200 ₽

4. Аксессуары:
   - Соломенная шляпа - 1500 ₽
   - Солнцезащитные очки - 2000 ₽
   - Пляжная сумка - 2500 ₽

Общая стоимость: 29800 ₽

[Показываются изображения предлагаемых товаров с возможностью детализации]
```

### Нутрициолог

```
Пользователь: Я хочу составить план питания для похудения. Мой бюджет
на еду 15 тысяч в неделю. Не ем мясо, только рыбу.

Ассистент: [Анализирует предпочтения, рассчитывает КБЖУ]

Ассистент: Я составил для вас план питания на неделю с учетом пескетарианской диеты и цели похудения:

1. Завтраки:
   - Омлет с овощами и зеленью
   - Овсянка с ягодами и греческим йогуртом
   - Смузи-боул с семенами чиа и фруктами

2. Обеды:
   - Киноа с запеченными овощами и филе трески
   - Средиземноморский салат с тунцом
   - Суп из чечевицы с тостом из цельнозернового хлеба

3. Ужины:
   - Запеченный лосось с овощами гриль
   - Паста из цельнозерновой муки с креветками и шпинатом
   - Рис с овощами и тофу

Список продуктов на неделю:
[Полный список продуктов с указанием стоимости]

Общая стоимость: 14200 ₽

Калории: 1600 ккал/день
Белки: 90г (23%)
Жиры: 50г (28%)
Углеводы: 195г (49%)

[Показываются изображения блюд и рецепты]
```

### Косметолог

```
Пользователь: У меня комбинированная кожа с жирной T-зоной и
склонностью к высыпаниям. Подберите уход, бюджет до 10 тысяч рублей.

Ассистент: [Анализирует тип кожи и проблемы]

Ассистент: Учитывая ваш тип кожи и проблемы, я рекомендую следующий комплекс ухода:

1. Очищение:
   - Пенка для умывания с салициловой кислотой - 990 ₽
   - Очищающий тоник для комбинированной кожи - 850 ₽

2. Уход:
   - Сыворотка с ниацинамидом - 1900 ₽
   - Легкий некомедогенный увлажняющий крем - 1600 ₽
   - Локальное средство с бензоил пероксидом для высыпаний - 800 ₽

3. Защита:
   - Санскрин с матирующим эффектом SPF 50 - 1200 ₽

4. Дополнительный уход:
   - Маска с глиной (1-2 раза в неделю) - 750 ₽
   - Мицеллярная вода для снятия макияжа - 490 ₽

Общая стоимость: 8580 ₽

Рекомендуемый порядок применения:
[Детальная инструкция по применению]

[Показываются изображения рекомендуемых товаров]
```

### Дизайнер

```
Пользователь: Хочу обновить гостиную в скандинавском стиле.
Площадь 18 кв.м, бюджет 150 тысяч рублей.

Ассистент: [Анализирует потребности для оформления интерьера]

Ассистент: Для обновления вашей гостиной в скандинавском стиле я предлагаю следующее решение:

1. Основная мебель:
   - Светлый диван с текстильной обивкой - 45000 ₽
   - Журнальный столик из светлого дерева - 12000 ₽
   - Компактная тумба под ТВ - 18000 ₽

2. Освещение:
   - Напольная лампа с деревянным основанием - 7500 ₽
   - Подвесной светильник с минималистичным дизайном - 9000 ₽

3. Текстиль:
   - Ковер с геометрическим узором - 14000 ₽
   - Декоративные подушки (4 шт) - 6000 ₽
   - Легкие шторы - 8000 ₽

4. Декор и хранение:
   - Настенные полки из светлого дерева - 6500 ₽
   - Комнатные растения с кашпо - 8000 ₽
   - Минималистичные постеры в рамах (3 шт) - 7500 ₽
   - Корзины для хранения - 4500 ₽

Общая стоимость: 146000 ₽

[Показываются изображения предлагаемых товаров и визуализация интерьера]
```

## Анализ банковских выписок

Одной из ключевых особенностей решения является интеграция с банковскими выписками:

```
Пользователь: Проанализируй мои расходы за последний месяц.
[Загружает выписку из Тинькофф]

Ассистент: [Анализирует выписку, категоризирует траты]

Ассистент: На основе анализа вашей банковской выписки:

1. Общие расходы за месяц: 84600 ₽
2. Основные категории трат:
   - Продукты: 23400 ₽ (28%)
   - Рестораны: 12800 ₽ (15%)
   - Одежда: 15600 ₽ (18%)
   - Транспорт: 8500 ₽ (10%)
   - Развлечения: 7200 ₽ (9%)
   - Прочее: 17100 ₽ (20%)

3. По сравнению с предыдущим месяцем:
   - Общие расходы выросли на 12%
   - Наибольший рост в категории "Одежда" (+35%)
   - Снижение в категории "Транспорт" (-8%)

4. Рекомендации:
   - Учитывая ваши расходы на одежду, рекомендую установить бюджет не более 10000 ₽ на новые покупки в этом месяце
   - Рассмотрите возможность сократить траты в ресторанах, это позволит увеличить бюджет на другие категории

[Показываются графики распределения расходов]
```

## Запуск с использованием Docker

### Предварительные требования

- Docker и Docker Compose
- Создайте файл `.env` с необходимыми переменными окружения

### Шаги для запуска

1. Клонируйте репозиторий:

   ```bash
   git clone <url-репозитория>
   cd <директория-проекта>
   ```
2. Создайте файл `.env` с необходимыми API ключами:

   ```
   # API ключи для работы ассистента
   OPENAI_API_KEY=your_openai_api_key_here
   OPENROUTER_API_KEY=your_openrouter_api_key_here

   # Настройки для логирования
   LOG_LEVEL=INFO
   ```
3. Соберите и запустите контейнеры с помощью Docker Compose:

   ```bash
   # Linux/Mac
   chmod +x start.sh
   ./start.sh

   # Windows
   start.bat

   # Или вручную
   docker-compose build
   docker-compose up -d
   ```
4. Приложение будет доступно по следующим адресам:

   - Фронтенд: http://localhost:3000
   - API бэкенда: http://localhost:8000
   - Документация API: http://localhost:8000/docs

## Разработка без Docker

### Бэкенд

1. Создайте виртуальное окружение Python и активируйте его:

   ```bash
   python -m venv venv
   source venv/bin/activate  # для Linux/Mac
   venv\Scripts\activate  # для Windows
   ```
2. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```
3. Запустите сервер:

   ```bash
   uvicorn api:app --reload
   ```

### Фронтенд

1. Перейдите в директорию web-interface:

   ```bash
   cd web-interface
   ```
2. Установите зависимости:

   ```bash
   npm install
   ```
3. Запустите сервер разработки:

   ```bash
   npm run dev
   ```

## Заключение

Shopping Copilot представляет собой комплексное решение для упрощения процесса онлайн-шопинга, сочетающее несколько экспертных ролей, анализ финансовых возможностей пользователя и интеграцию с маркетплейсами для поиска оптимальных товаров. Система адаптируется под индивидуальные предпочтения пользователя и помогает принимать обоснованные решения о покупках.

## Дальнейшее развитие

Планируемые направления развития проекта:

1. Расширение интеграции с другими маркетплейсами (Ozon, AliExpress)
2. Добавление поддержки банковских выписок других банков
3. Улучшение алгоритмов категоризации расходов и прогнозирования
4. Интеграция с сервисами доставки продуктов для нутрициологических рекомендаций
5. Добавление функции AR для предварительного просмотра товаров в интерьере
